---
import { Search } from "accel-record/search";
import { Direction, sortUrl } from "./sort.js";

type Props = {
  q: Search<any>;
  key: string;
  defaultOrder?: Direction;
  keys?: string[];
  asc?: string;
  desc?: string;
} & astroHTML.JSX.LinkHTMLAttributes;

const { q, key, defaultOrder, keys, asc, desc, ...linkAttrs } = Astro.props;
const url = Astro.request.url;
const sortOrder = url.includes(`${key}+desc`) ? "desc" : url.includes(`${key}+asc`) ? "asc" : "";
const href = sortUrl(q, key, { request: Astro.request, defaultOrder, keys });
---

<a {...linkAttrs} {href}>
  <slot>
    <span class="sort-link__text">{q.model.humanAttributeName(key)}</span>
  </slot>
  {
    sortOrder != "" && (
      <span class={`sort-link__icon sort-link__icon--${sortOrder}`}>
        {sortOrder === "asc" ? asc ?? "▲" : desc ?? "▼"}
      </span>
    )
  }
</a>
