---
import { formAuthenticityToken } from "../csrf.js";
import { createCookieSessionStorage } from "../session.js";

const createSession = () => createCookieSessionStorage().getSession(Astro.cookies);
const session = (Astro.locals as any).session ?? createSession();
const authenticityToken = formAuthenticityToken(session);
---

<form {...Astro.props}>
  {authenticityToken && <input type="hidden" name="authenticity_token" value={authenticityToken} />}
  <slot />
</form>
